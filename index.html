<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRETA - 창작자를 위한 플랫폼</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 로그인 모달 -->
    <div id="authModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>CRETA에 오신 것을 환영합니다!</h2>
                <button class="modal-close" onclick="hideAuthModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="showLogin()">로그인</button>
                    <button class="auth-tab" onclick="showSignup()">회원가입</button>
                </div>
                
                <div id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label>이메일</label>
                        <input type="email" id="loginEmail" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="loginPassword" placeholder="비밀번호를 입력하세요">
                    </div>
                    <button class="btn btn-primary" onclick="loginUser()">로그인</button>
                    
                    <div class="social-login">
                        <button class="btn btn-google" onclick="loginWithGoogle()">
                            🔵 Google로 로그인
                        </button>
                    </div>
                </div>
                
                <div id="signupForm" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label>이름</label>
                        <input type="text" id="signupName" placeholder="닉네임을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label>이메일</label>
                        <input type="email" id="signupEmail" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="signupPassword" placeholder="6자 이상 입력하세요">
                    </div>
                    <button class="btn btn-primary" onclick="signupUser()">회원가입</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 기존 CRETA HTML 구조 -->
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">🎨</span>
                    <span class="logo-text">CRETA</span>
                </div>
                <div class="search-bar">
                    <span class="search-icon">🔍</span>
                    <input type="text" placeholder="작품, 작가, 태그 검색..." class="header-search">
                </div>
                <div class="user-info">
                    <button class="notification-btn">
                        <span class="icon">🔔</span>
                        <span class="badge">3</span>
                    </button>
                    <div class="user-avatar" onclick="showProfile()">
                        <span id="userAvatarText">로그인</span>
                    </div>
                    <button class="logout-btn" onclick="logoutUser()" style="display: none;">로그아웃</button>
                </div>
            </div>
        </header>

        <div class="main-layout">
            <nav class="sidebar">
                <button class="nav-item active" onclick="showScreen('home')" data-screen="home">
                    <div class="nav-icon">🏠</div>
                    <span>홈</span>
                </button>
                <button class="nav-item" onclick="showScreen('explore')" data-screen="explore">
                    <div class="nav-icon">🔍</div>
                    <span>탐색</span>
                </button>
                <button class="nav-item" onclick="showScreen('community')" data-screen="community">
                    <div class="nav-icon">👥</div>
                    <span>커뮤니티</span>
                </button>
                <button class="nav-item" onclick="showScreen('messages')" data-screen="messages">
                    <div class="nav-icon">💬</div>
                    <span>메시지</span>
                    <span class="nav-badge">2</span>
                </button>
                <button class="nav-item" onclick="showScreen('profile')" data-screen="profile">
                    <div class="nav-icon">👤</div>
                    <span>프로필</span>
                </button>
                <div class="nav-divider"></div>
                <button class="nav-item upload-btn" onclick="showUploadModal()">
                    <div class="nav-icon create-icon">➕</div>
                    <span>작품 업로드</span>
                </button>
            </nav>

            <main class="content-area">
                <!-- 홈 화면 -->
                <div id="home" class="screen active">
                    <div class="home-banner">
                        <div class="banner-content">
                            <h1>오늘의 추천 작품</h1>
                            <p>CRETA에서 선별한 최고의 창작물들을 만나보세요</p>
                        </div>
                        <div class="featured-works">
                            <div class="featured-item large">
                                <img src="https://via.placeholder.com/400x250/1f2937/f3f4f6?text=Featured+Work" alt="추천 작품">
                                <div class="featured-overlay">
                                    <div class="featured-info">
                                        <h3>하이큐!! 최신 팬아트</h3>
                                        <p>애니메이터 김철수</p>
                                        <div class="featured-stats">
                                            <span>❤️ 1.2K</span>
                                            <span>👀 5.8K</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="content-sections">
                        <section class="works-section">
                            <div class="section-header">
                                <h2>🔥 인기 작품</h2>
                                <button class="see-more-btn">더보기</button>
                            </div>
                            <div class="works-grid" id="worksContainer">
                                <!-- 작품들이 여기에 동적으로 로드됩니다 -->
                            </div>
                        </section>
                    </div>
                </div>

                <!-- 다른 화면들... -->
                <div id="explore" class="screen">
                    <h2>탐색 화면</h2>
                    <p>검색 및 탐색 기능이 여기에 구현됩니다.</p>
                </div>

                <div id="community" class="screen">
                    <h2>커뮤니티 화면</h2>
                    <p>커뮤니티 기능이 여기에 구현됩니다.</p>
                </div>

                <div id="messages" class="screen">
                    <h2>메시지 화면</h2>
                    <p>실시간 채팅 기능이 여기에 구현됩니다.</p>
                </div>

                <div id="profile" class="screen">
                    <div class="profile-container">
                        <div class="profile-banner">
                            <div class="profile-main">
                                <div class="profile-avatar-large" id="profileAvatar">김</div>
                                <div class="profile-info">
                                    <h1 id="profileName">김창작</h1>
                                    <p class="profile-bio">일러스트레이터 • 애니메이션 덕후</p>
                                    <div class="profile-stats">
                                        <div class="stat">
                                            <span class="stat-number">0</span>
                                            <span class="stat-label">팔로워</span>
                                        </div>
                                        <div class="stat">
                                            <span class="stat-number">0</span>
                                            <span class="stat-label">팔로잉</span>
                                        </div>
                                        <div class="stat">
                                            <span class="stat-number">0</span>
                                            <span class="stat-label">작품</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 작품 업로드 모달 -->
    <div id="uploadModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>새 작품 업로드</h2>
                <button class="modal-close" onclick="hideUploadModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>작품 제목</label>
                    <input type="text" id="workTitle" placeholder="작품 제목을 입력하세요">
                </div>
                <div class="form-group">
                    <label>작품 설명</label>
                    <textarea id="workDescription" placeholder="작품에 대한 설명을 입력하세요"></textarea>
                </div>
                <div class="form-group">
                    <label>카테고리</label>
                    <select id="workCategory">
                        <option value="illustration">일러스트</option>
                        <option value="animation">애니메이션</option>
                        <option value="novel">소설</option>
                        <option value="manga">만화</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>이미지 파일</label>
                    <input type="file" id="workImage" accept="image/*">
                    <div id="imagePreview"></div>
                </div>
                <div class="form-group">
                    <label>태그</label>
                    <input type="text" id="workTags" placeholder="태그를 쉼표로 구분해서 입력하세요">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideUploadModal()">취소</button>
                <button class="btn btn-primary" onclick="uploadWork()">업로드</button>
            </div>
        </div>
    </div>

    <!-- Firebase 스크립트 -->
    <script type="module">
        // Firebase 설정
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYrLmXnpMPd0FjGQ-3_IXBF_ZqGV-mOk8",
            authDomain: "creta-30c69.firebaseapp.com",
            projectId: "creta-30c69",
            storageBucket: "creta-30c69.firebasestorage.app",
            messagingSenderId: "126716257571",
            appId: "1:126716257571:web:33dfd5dbd1bcdb7a229896"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // 전역으로 내보내기
        window.auth = auth;
        window.db = db;
        window.storage = storage;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithPopup = signInWithPopup;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOut = signOut;
        window.updateProfile = updateProfile;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.doc = doc;
        window.setDoc = setDoc;
        window.serverTimestamp = serverTimestamp;
        window.query = query;
        window.orderBy = orderBy;
        window.ref = ref;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;

        // 인증 상태 확인
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('사용자 로그인:', user.email);
                updateUserInterface(user);
                hideAuthModal();
                loadWorks();
            } else {
                console.log('사용자 로그아웃');
                showAuthModal();
                resetUserInterface();
            }
        });

        // 사용자 인터페이스 업데이트
        function updateUserInterface(user) {
            const userAvatarText = document.getElementById('userAvatarText');
            const logoutBtn = document.querySelector('.logout-btn');
            
            if (userAvatarText) {
                userAvatarText.textContent = user.displayName ? user.displayName.charAt(0) : user.email.charAt(0);
            }
            
            if (logoutBtn) {
                logoutBtn.style.display = 'block';
            }
        }

        function resetUserInterface() {
            const userAvatarText = document.getElementById('userAvatarText');
            const logoutBtn = document.querySelector('.logout-btn');
            
            if (userAvatarText) {
                userAvatarText.textContent = '로그인';
            }
            
            if (logoutBtn) {
                logoutBtn.style.display = 'none';
            }
        }

        // 작품 로드
        async function loadWorks() {
            try {
                const worksQuery = query(collection(db, 'works'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(worksQuery);
                const worksContainer = document.getElementById('worksContainer');
                
                if (worksContainer) {
                    worksContainer.innerHTML = '';
                    
                    querySnapshot.forEach((doc) => {
                        const work = doc.data();
                        const workElement = createWorkElement(work);
                        worksContainer.appendChild(workElement);
                    });
                }
            } catch (error) {
                console.error('작품 로드 실패:', error);
            }
        }

        function createWorkElement(work) {
            const workDiv = document.createElement('div');
            workDiv.className = 'work-item';
            workDiv.innerHTML = `
                <img src="${work.imageUrl || 'https://via.placeholder.com/200x160/1f2937/f3f4f6?text=No+Image'}" alt="${work.title}" class="work-thumbnail">
                <div class="work-content">
                    <h3>${work.title}</h3>
                    <div class="work-author">${work.authorName}</div>
                    <div class="work-stats">
                        <span>❤️ ${work.likes || 0}</span>
                        <span>👀 ${work.views || 0}</span>
                    </div>
                </div>
            `;
            return workDiv;
        }

        // 전역 함수로 내보내기
        window.updateUserInterface = updateUserInterface;
        window.resetUserInterface = resetUserInterface;
        window.loadWorks = loadWorks;
    </script>

    <script src="script.js"></script>
</body>
</html>
